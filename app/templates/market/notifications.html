{% extends "base.html" %}
{% load i18n %}
{% load compress %}

{% block outsidecontainer %}
<div style="height:50px;"></div>
  <div id="market">
  <!-- Banner -->
  <!-- Filter Spacer -->
  <div class="action-banner-spacer"></div>
  <div id="action-wrapper">
    <div id="fixed-actions">
      <div class="exchange-actions">
        <div class="container">

        </div>
      </div>
      <div class="filter-banner-spacer-black"></div>

    </div>
  </div>
{% endblock %}

{% block content %}
  <div style="margin-top:10px;">
    <ul class="list-group" id="notificatoins">
    </ul>
  </div>
  <div class="btn btn-default" id="more">{%trans "More"%}</div>

  <script type="text/template" id="notificationspage_template">
    <li class="notif-seen list-group-item <% if(notif.seen){ %>true<% }else{ %>false<%}%>">
        <div class="row" >
            <div class="col-xs-8">
              <div class="row">
                <div class="col-md-1 col-xs-2">
                  <% if(notif.comment===null){ %>
                    <a href="<%- window.ahr.app_urls.viewuserprofile+notif.owner %>">
                  <% }else{ %>
                    <a href="<%- window.ahr.app_urls.viewuserprofile+notif.comment_user %>">
                  <% } %>
                      <img style="border-radius:50%;margin-bottom:10px;" width="30" height="30" src="<%- notif.avatar %>"/>
                    </a>
                </div>
                <div class="col-md-11 col-xs-10">
                  <% if(notif.read==false){ %><strong><%}%>
                  <% if(notif.comment===null){ %>
                      <a href="<%- window.ahr.app_urls.viewuserprofile+notif.user%>">
                        <%- notif.owner %>
                      </a>
                      <% if(notif.text.update==true ){ %>{%trans "updated"%}<%}else { %> {%trans "posted"%} <%}%> {%trans "the"%} <%- notif.item_type %>
                      <a href="/market/#item/<%- notif.item_id %>">
                        "<%- notif.text.title %>"
                      </a>
                  <% }else{ %>
                      <a href="<%- window.ahr.app_urls.viewuserprofile+notif.comment_user%>">
                        <%- notif.comment_user %>
                      </a>
                      <a href="/market/#item/<%- notif.item_id %>" style="display:inline-block;">
                        {%trans "commented on"%} <% if(notif.owner_id==window.ahr.user_id){ %>{%trans "your"%}<%}%> <%- notif.item_type %> "<%- notif.text.title %>"
                      </a>
                  <% } %>
                  <% if(notif.read==false){ %></strong><%}%><br/>
                </div>
              </div>
            </div>
            <div class="col-xs-4">
                <div class="row">
                  <div class="col-md-offset-8 col-md-4">
                    <%- moment(notif.pub_date,"YYYY-MM-DD h:mm").fromNow() %>
                  </div>
                </div>
            </div>
         </div>
    </li>
</script>

{% endblock %}

{% block endjavascript %}
  {% compress js inline %}
  <script type="text/javascript">

    $(document).ready(function () {
      var notificationsPage = Backbone.View.extend({
        el: 'body',
        counter: 0,
        events: {
          'click #more': 'showmore'
        },

        showmore: function (ev) {
          var that = this;
          var dfrd = $.ajax({
            url: window.ahr.app_urls.getmarketnotificationsfromto.replace(0, that.counter) + (that.counter + 15)
          });
          dfrd.done(function (data) {
            _.each(data.notifications, function (notif) {
              $('#notificatoins').append(that.tmpl({'notif': notif}));
            });
            that.counter = that.counter + 15;
          });
        },

        initialize: function () {
          this.tmpl = _.template($('#notificationspage_template').html());
          this.showmore()
        }
      });
      var np = new notificationsPage();
    });


  </script>
  {% endcompress %}

{% endblock %}


