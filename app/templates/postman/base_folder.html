{% extends "base_v2.html" %}
{% load url from future %}
{% load i18n postman_tags %}
{% load pagination_tags %}
{% load avatar_tags %}

{% comment %}
  WARNING: 'pagination_tags' is a name from the django-pagination application.
  For convenience, the design of this template is done with the use of that application.
  Django-postman will still be working, even if that application is not installed, by providing a mock
  for the template tag library.
  If the real implementation is to be used, just make sure that 'pagination' is declared before 'postman'
  in the INSTALLED_APPS setting.
{% endcomment %}

{% block header_padding %}{% endblock %}
{% block content_outside_container %}
    {% include "users/snippets/profile_navigation.html" with page_type="inbox" %}
{% endblock %}

{% block content %}
{% block headerinfo %}{% endblock %}
{% url 'postman_inbox' as inbox %}
{% url 'postman_sent' as sent %}
{% url 'postman_archives' as archive %}
{% url 'postman_trash' as trash%}
{% with request.get_full_path as path %}
<div id="postman">
    <div class="row">
      <div class="col-md-4 pull-left">
        <div class="btn-group btn-group-justified btn-group-md" id="messagenav" style="padding:0 10px 10px 10px">
          <a type="button" class="btn btn-default {%if path == inbox %} selected {% endif %}" href="{{inbox}}">Inbox</a>
          <a type="button" class="btn btn-default {%if path == sent %} selected {% endif %}" href="{{sent}}">Sent</a>
          <a type="button" class="btn btn-default {%if path == archive %} selected {% endif %}" href="{{archive}}">Archive</a>
        </div>
      </div>
      <div class="col-md-8" id="message-col">
    {% autopaginate pm_messages %}
    {% if invalid_page %}
      <p>{% trans "Sorry, this page number is invalid." %}</p>
    {% else %}
      {% if pm_messages %}
      <form action="{% block pm_form_action %}{% endblock %}" method="post">{% csrf_token %}
        <div id="pm_messages">
          <div>
            {% block pm_form_buttons %}
             <div style="margin-bottom:15px;" class="row">
              <div class="col-md-12" id="pm_buttons">
                {% block pm_unarchive_button %}
                  <button style="width:100px;" type="submit" class="btn btn-default btn-sm" onclick="this.form.action='{% url 'postman_unarchive' %}'">
                    <span class="glyphicon glyphicon-open"></span> {% trans "Unarchive" %}
                  </button>
                {% endblock %}
                {% block pm_archive_button %}
                  <button style="width:100px;" type="submit" class="btn btn-default btn-sm" onclick="this.form.action='{% url 'postman_archive' %}'">
                    <span class="glyphicon glyphicon-save"></span> {% trans "Archive" %}
                  </button>
                {% endblock %}
              </div>
              {% endblock %}
            </div>
            <div class="dialog">
              <div class="row messagelist">
                {% for message in pm_messages %}
                <div class="col-xs-12 message">
                  <div class="container-fixed">
                    <div class="message-well">
                      <div class="messageavatar">
                        <input type="checkbox" {% if by_conversation and message.thread_id %}name="tpks" value="{{ message.thread_id }}"{% else %}name="pks" value="{{ message.pk }}"{% endif %} />
                        {% primary_avatar message.sender 40 %}
                      </div>
                      <div class="conv_link" href="{% if by_conversation and message.thread_id %}{% url 'postman_view_conversation' message.thread_id %}{% else %}{{message.get_absolute_url }}{% endif %}?next={{ current_url|urlencode }}">
                      <div class="hidden-xs hidden-sm col-sm-3 col-md-2 sender">
                        <strong>
                        {% block pm_sender_cell %}
                          {{ message.obfuscated_sender|or_me:user }}{% if message.count %} ({{ message.count }}){% endif %}
                        {% endblock %}
                        {% block pm_recipient_cell %}
                          {{ message.obfuscated_recipient|or_me:user }}
                          {% if message.count %}
                            ({{ message.count }})
                           {% endif %}
                        {% endblock %}
                        </strong>
                      </div>
                      <div class="col-xs-6 col-sm-7 col-md-7 subject">
                          {%if path != sent %}{% if message.is_new %}<strong>{% endif %}{% endif %}
                          {% if message.is_replied %}<em>{% endif %}

                          {% block pm_subject %}
                              {% include "postman/inc_subject_ex.html" %}
                          {% endblock %}

                          {% if message.is_replied %}</em>{% endif %}
                          {%if path != sent %}{% if message.is_new %}</strong>{% endif %}{% endif %}
                      </div>
                      <div class="col-xs-3 col-sm-3 col-md-2" style="text-align:right;line-height:45px;">
                        {{ message.sent_at|compact_date:_("g:i A,M j,n/j/y") }}
                      </div>
                      </div>
                    </div>
                  </div>
                </div>
                {% endfor %}
              </div>
            </div>
          </div>
          <div id="paginationblock">
          {% paginate %}
          </div>
        </div>

        <div class="col-md-9" id="conversation-cont">
          <div class="panel" id="back" style="margin-top:10px;">
              <ol class="breadcrumb" style="margin-bottom: 0px;">
                <li id="backtofolder" style="cursor:pointer;" class="">
                {%if path == inbox %}
                  Inbox
                {% elif path == sent %}
                  Sent
                {% elif path == trash %}
                  Trash
                {% else %}
                  Archive
                {%endif%}
                </li>
                <li class="active" id="breadsubject"></li>
              </ol>
          </div>
          <div class="panel">
            <a id="convst"></a>
            <div class="col-md-12" id="conversation"></div>
          </div>
        </div>
      </form>

      {% else %}
        <div class="col-md-12">
          <div class="dialog">
            <p>{% trans "No messages." %}</p>
          </div>
        </div>
      {% endif %}
    {% endif %}
      </div>
    </div>
</div>

{% endwith %}
{% endblock content %}

{% block endjavascript %}
  {% include "market/clientside/actions/actions.html" %}
{% endblock %}
