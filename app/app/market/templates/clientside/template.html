<script type="text/template" id="comment_edit_template">
    <div class="comment" comment-id="<%=pk%>">
        <div class="comment-wrap">
            <div class="comment-userpic"><img src="<%=userpic%>"/></div>
            <div class="comment-right">
                <div class="comment-head">
                    <div class="comment-user"><%=user%></div>
                    <div class="comment-date"><%=pub_date%></div>
                </div>
                <div class="comment-content"><%=content%></div>
            </div>
        </div>
    </div>
</script>

<script type="text/template" id="filter-tag">
    <div style="display:inline-block;margin:3px;">
        <button type="button" class="btn btn-default btn-xs tagbutton <%=active%>"><%=filtertag%></button>
    </div>
</script>


<script type="text/template" id="type-tag">
    <button type="button" class="btn item-type offer btn-default btn-sm btn-success"><%=typetag%></button>
</script>



<script type="text/javascript" id="api_urls">
    window.ahr= window.ahr || {};
    try{
        window.user_id = {{ user.id }};
    }catch(err){
         window.user_id = 0;
    }

    window.ahr.market_filter_custom = {skills:[1],country:[1],issues:[1,2,3]};

    window.ahr.app_urls={
        postmanwrite: "{% url 'postman_write' 'a' %}".slice(0,-1),
        postmanreply: "{% url 'postman_reply' 0 %}".slice(0,-1),
        // postman_view_conversation
        // postman_delete

        getcsrf: "{% url 'get_csrftoken' 'json' %}",
        getuserdetail: "{% url 'get_userdetail' 'json' 0 %}".slice(0,-1),
        getavatar: "{% url 'get_avatar' 'json' 0 %}".slice(0,-1),
        getusercount: "{% url 'get_usercount' 'json' %}",
        getuserfromto: "{% url 'get_user_fromto' 'json' 0 0 %}".slice(0,-1),
        viewuserprofile: "{% url 'user_profile_for_user' 'a' %}".slice(0,-1),
        setuserrate: "{% url 'user_set_rate' 'json' 'a' %}".slice(0,-1),

        getissues: "{% url 'get_issues' 'json' %}",
        getskills: "{% url 'get_skills' 'json' %}",
        getcountries: "{% url 'get_countries' 'json' %}",
        getNationalities: "{% url 'get_nationalities' 'json' %}",
        getmessagecount: "{% url 'get_messagecount' 'json' %}",

        viewitem: "{% url 'view_item' 'offer' 0 %}".slice(0,-1),
        edititem: "{% url 'form_edit_item' 0 %}".slice(0,-1),
        getitemform:  "{% url 'form_add_item' 'offer' %}",

        market: "{% url 'show_market' %}",
        getposts:  "{% url 'posts'  %}",
        getmarketitem: "{% url 'get_marketitem' 'json' 0 %}".slice(0,-1),
        getmarketitemlast: "{% url 'get_marketitems_last' 'json' 0 %}".slice(0,-1),
        getmarketitemfromto: "{% url 'get_marketitems_fromto' 'json' 0 0 %}".slice(0,-1),
        getmarketcount: "{% url 'get_marketitem_count' 'json' %}",
        addmarketitem: "{% url 'add_marketitem' 'json' 'offer' %}".slice(0,-5),
        editmarketitem: "{% url 'edit_marketitem' 'json' 0 %}".slice(0,-1),
        deletemarketitem: "{% url 'delete_marketitem' 'json' 0 %}".slice(0,-1),
        getuseritems: "{% url 'user_marketitems' 'json' %}",
        getuseritemscount: "{% url 'user_items_count' 'json' %}",
        getusermarketitemsfromto : "{% url 'get_usermarketitems_fromto' 'json' 0 0 %}".slice(0,-1),
        sendmessage: "{% url 'send_message' 'json' 0 %}".slice(0,-1),

        formeditcomment: "{% url 'form_edit_comment' 0 %}".slice(0,-1),

        addcomment: "{% url 'add_comment' 'json' 0 %}".slice(0,-1),
        getcomment: "{% url 'get_comment' 'json' 0 %}".slice(0,-1),
        getcommentsrange: "{% url 'get_comments_range' 'json' 0 'stdate' 'enddate' %}",
        getcommentslast: "{% url 'get_comments_last' 'json' 0 0 %}".slice(0,-1),
        editcomment: "{% url 'edit_comment' 'json' 0 %}".slice(0,-1),
        deletecomment: "{% url 'delete_comment' 'json' 0 %}".slice(0,-1)
    };

    window.getcsrf = function(callback){
        $.getJSON(window.ahr.app_urls.getcsrf, function(data){callback(data);});
    }

    function getpkname(data,item){
        var ar={};
        for(index in data){
            ar[data[index].pk] = data[index].fields[item];
        }
        return ar;
    }


    function getstatics(){
    var dfrd = $.Deferred();
    var dfrd1=$.ajax({url:window.ahr.app_urls.getissues,dataType:'json'});
    dfrd1.done(function(data){
        window.issues = getpkname(data,'issues');
        var dfrd2 = $.ajax({url:window.ahr.app_urls.getskills,dataType:'json'});
        dfrd2.done(function(data){
            window.skills = getpkname(data,'skills');
            var dfrd3 = $.ajax({url:window.ahr.app_urls.getcountries,dataType:'json'});
            dfrd3.done(function(data){
                window.countries = getpkname(data,'countries');
                dfrd.resolve();
            });
        });
    });
    return dfrd;
    }

</script>
